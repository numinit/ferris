goog.require('zx');

goog.require('zx.Context');

(function(top) {
    var zx = top['ZXClient'];

    if (zx._started) {
        return;
    }

    // Terrible hack
    console.log = function(str) {
        str = (new Date()).toISOString() + ': ' + str;
        var el = document.getElementById('log');
        if (el) {
            var child = document.createElement('p');
            child.textContent = str;
            el.insertBefore(child, el.children[0]);
            if (el.children.length > 10) {
                el.removeChild(el.children[el.children.length - 1]);
            }
        }
    };

    console.log('client starting');
    zx._started = true;
    zx._context = new zx.Context(top, '<%= ApplicationHelper.base_uri %>', '<%= asset_path "zx-worker.js" %>');
    zx._context.run();
})(this);

